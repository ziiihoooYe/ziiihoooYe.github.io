!function(){function t(t){const e=/rn(\d+)\.png$/,n=t.match(e);return n&&n[1]?parseInt(n[1],10):null}function e(t,e){var n=new Image;n.onload=function(){e(!0)},n.onerror=function(){e(!1)},n.src=t}function n(t,e,n,r){var i=+t.attr("x"),a=+t.attr("y"),l=+t.attr("width"),c=+t.attr("height"),d=n.append("svg:image").attr("id","transition_"+t.id).attr("width",l).attr("height",c).attr("xlink:href",t.attr("xlink:href")).attr("x",i).attr("y",a).style("opacity",1);t.attr("xlink:href",e),t.transition().duration(r),d.transition().duration(r).style("opacity",0).attr("x",i).attr("y",a).remove()}function r(){function r(){const t=d3.select(this).data()[0];var e=R.select("#rn"),r=R.select("#baseline"),i=R.select("#dr"),a=R.select("#ref");E!=t.id&&(z.selectAll(".indicator_image").data(v).attr("opacity",function(e){return t.id==e.id?1:.2}),E=t.id,n(e,(I="/assets/img/de-rain_img/"+E+"/")+"rn0.png",R,500),n(r,I+"baseline0.png",R,500),n(i,I+"dr0.png",R,500),n(a,I+"ref0.png",R,500))}var i={top:10,right:60,bottom:30,left:60},a=70,l=5,c=10,d=2,o=2,s=2,p=25,f=3,g=8,u=60,h=20,y=4,x=27,m=2,$=s*d*a+(d-1)*l,k=o*a+(o-1)*c,w=k+p+f+g,v=[{x:0,y:0,id:"Cityscapes",opacity:1},{x:2*p+f,y:0,id:"BDD",opacity:.2}],_=[{id:"rn",cx:-i.left/2,cy:a/2,r:x},{id:"baseline",cx:s*a*d+l+i.right/2,cy:a/2,r:x},{id:"dr",cx:s*a*d+l+i.right/2,cy:a/2+a+c,r:x}],b=document.createElement("canvas");b.width=2*x,b.height=2*x;b.getContext("2d");var A=d3.select("#result_div").append("svg").attr("width","100%").attr("height","100%").style("min-width",`${($+i.left+i.right)/2}px`).attr("viewBox",`0 0 ${$+i.left+i.right} ${w+i.top+i.bottom}`),R=A.append("g").attr("id","image_group").attr("width",$).attr("height",k).attr("transform",`translate(${i.left}, ${i.top})`),z=A.append("g").attr("id","indicator_group").attr("width",2*s*p+f).attr("height",p+f+c).attr("transform",`translate(${i.left}, ${i.top+k+c+g})`),C=A.append("g").attr("id","button_group").attr("width",u+2*y).attr("height",h+2*y).attr("transform",`translate(${$+i.left-(u+y)}, ${i.top+k+c+g})`),D=A.append("g").attr("id","zoom_group").attr("transform",`translate(${i.left}, ${i.top})`).selectAll("circle").data(_).enter().append("circle").attr("id",function(t){return t.id+"circle"}).attr("r",function(t){return t.r}).attr("cx",function(t){return t.cx}).attr("cy",function(t){return t.cy}).style("fill","none");_.forEach(function(t){A.append("defs").append("clipPath").attr("id","clip-"+t.id).append("circle").attr("cx",t.cx+i.left).attr("cy",t.cy+i.top).attr("r",t.r)}),z.append("text").attr("x",z.attr("width")/2).attr("y",-g/2).attr("text-anchor","middle").style("font-weight",700).style("font-size","6px").text("Click to select a different dataset:").style("font-family","sans-serif");var E="Cityscapes",I="/assets/img/de-rain_img/"+E+"/",B=[{x:0,y:0,id:"rn",link:I+"rn0.png",title:"Rainy Image"},{x:s*a+l,y:0,id:"baseline",link:I+"baseline0.png",title:"Baseline De-rained Result"},{x:0,y:a+c,id:"ref",link:I+"ref0.png",title:"Reference Image"},{x:s*a+l,y:a+c,id:"dr",link:I+"dr0.png",title:"Pipeline De-rained Result"}];R.selectAll("image").data(B).enter().append("svg:image").attr("class","result_image").attr("width",s*a).attr("height",a).attr("xlink:href",function(t){return t.link}).attr("id",function(t){return t.id}).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).on("mousemove",function(t,e){const n=e.id;if(["rn","baseline","dr"].includes(n)){const[e,n]=d3.pointer(t);D.each(function(t){const r=B.find(e=>e.id===t.id);d3.select("#clip-"+t.id).selectAll("image").remove();d3.select("#clip-"+t.id).append("image").attr("clip-path","url(#clip-"+t.id+")").attr("xlink:href",r.link).attr("x",t.cx+i.left-e*m).attr("y",t.cy+i.top-n*m).attr("width",s*a*m).attr("z",1).attr("height",a*m)})}}),R.selectAll("text").data(B).enter().append("text").attr("id",function(t){return t.id+"_title"}).style("text-anchor","middle").style("font-weight",700).style("font-size","6px").text(function(t){return t.title}).attr("x",function(t){return a+t.x}).attr("y",function(t){return-3+t.y}).style("font-family","sans-serif");var P=z.selectAll("image").data(v);P.enter().append("text"),P.enter().append("image").attr("class","indicator_image").attr("width",2*p).attr("height",p).attr("xlink:href",function(t){return"/assets/img/de-rain_img/"+t.id+"/dr0.png"}).attr("id",function(t){return t.id}).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("opacity",function(t){return t.opacity}).on("click",r);C.append("rect").attr("width",u).attr("height",h).attr("x",y).attr("y",y).style("fill","white").style("stroke","gray").style("stroke-width",1);C.append("text").attr("id","button_text").style("text-anchor","middle").text("MORE RESULT").style("text-anchor","middle").attr("x",y+u/2).attr("y",y+h/2+2.5).style("font-weight",600).style("font-size","7px").style("font-family","sans-serif"),C.on("click",function(){const r=R.select("#rn"),i=R.select("#baseline"),a=R.select("#dr"),l=R.select("#ref"),c=r.attr("xlink:href"),d=i.attr("xlink:href"),o=a.attr("xlink:href"),s=l.attr("xlink:href");let p=t(c);if(null!==p){let t=p+1,f=c.replace(`${p}.png`,`${t}.png`),g=d.replace(`${p}.png`,`${t}.png`),u=o.replace(`${p}.png`,`${t}.png`),h=s.replace(`${p}.png`,`${t}.png`);e(u,function(e){if(e)n(r,f,R,500),n(i,g,R,500),n(a,u,R,500),n(l,h,R,500);else{t=0;let e=c.replace(`${p}.png`,`${t}.png`),f=d.replace(`${p}.png`,`${t}.png`),g=o.replace(`${p}.png`,`${t}.png`),u=s.replace(`${p}.png`,`${t}.png`);n(r,e,R,500),n(i,f,R,500),n(a,g,R,500),n(l,u,R,500)}})}}).on("mousedown",function(){d3.select(this).style("opacity",.2)}).on("mouseup",function(){d3.select(this).style("opacity",1)})}r()}();