!function(){function t(t){const e=/rn(\d+)\.png$/,r=t.match(e);return r&&r[1]?parseInt(r[1],10):null}function e(t,e){var r=new Image;r.onload=function(){e(!0)},r.onerror=function(){e(!1)},r.src=t}function r(t,e,r,n){var i=+t.attr("x"),a=+t.attr("y"),l=+t.attr("width"),c=+t.attr("height"),o=r.append("svg:image").attr("id","transition_"+t.id).attr("width",l).attr("height",c).attr("xlink:href",t.attr("xlink:href")).attr("x",i).attr("y",a).style("opacity",1);t.attr("xlink:href",e),t.transition().duration(n),o.transition().duration(n).style("opacity",0).attr("x",i).attr("y",a).remove()}function n(){function n(){const t=d3.select(this).data()[0];var e=z.select("#rn"),n=z.select("#baseline"),i=z.select("#dr"),a=z.select("#ref");E!=t.id&&(C.selectAll(".indicator_image").data(b).attr("opacity",function(e){return t.id==e.id?1:.2}),C.selectAll(".indicator-label").data(b).style("opacity",function(e){return t.id==e.id?1:.2}),E=t.id,r(e,(G="/assets/img/de-rain_img/"+E+"/")+"rn0.png",z,500),r(n,G+"baseline0.png",z,500),r(i,G+"dr0.png",z,500),r(a,G+"ref0.png",z,500))}var i={top:10,right:60,bottom:30,left:60},a=70,l=5,c=10,o=2,s=2,d=2,p=25,f=5,u=7,g=8,y=40,h=16,x=4,m=25,$=2,w=d*o*a+(o-1)*l,k=s*a+(s-1)*c,v=k+p+f+g,b=[{x:0,y:u,id:"Cityscapes",opacity:1},{x:2*p+f,y:u,id:"BDD",opacity:.2}],_=[{id:"rn",cx:-i.left/2,cy:a/2,r:m},{id:"baseline",cx:d*a*o+l+i.right/2,cy:a/2,r:m},{id:"dr",cx:d*a*o+l+i.right/2,cy:a/2+a+c,r:m}],A=document.createElement("canvas");A.width=2*m,A.height=2*m;A.getContext("2d");var D=d3.select("#result_div").append("svg").attr("width","100%").attr("height","100%").style("min-width",`${(w+i.left+i.right)/2}px`).attr("viewBox",`0 0 ${w+i.left+i.right} ${v+i.top+i.bottom}`),z=D.append("g").attr("id","image_group").attr("width",w).attr("height",k).attr("transform",`translate(${i.left}, ${i.top})`),C=D.append("g").attr("id","indicator_group").attr("width",2*d*p+f).attr("height",p+f+c).attr("transform",`translate(${i.left}, ${i.top+k+c+g})`),B=D.append("g").attr("id","button_group").attr("width",y+2*x).attr("height",h+2*x).attr("transform",`translate(${w+i.left-(y+x)}, ${i.top+k+c+g})`),R=D.append("g").attr("id","zoom_group").attr("transform",`translate(${i.left}, ${i.top})`),I=R.selectAll("circle").data(_).enter().append("circle").attr("id",function(t){return t.id+"circle"}).attr("r",function(t){return t.r}).attr("cx",function(t){return t.cx}).attr("cy",function(t){return t.cy}).style("fill","none");_.forEach(function(t){D.append("defs").append("clipPath").attr("id","clip-"+t.id).append("circle").attr("cx",t.cx).attr("cy",t.cy).attr("r",t.r)}),C.append("text").attr("x",C.attr("width")/2).attr("y",-g/2-2).attr("text-anchor","middle").style("font-weight",700).style("font-size","6px").text("Click to select a different dataset:").style("font-family","sans-serif");var E="Cityscapes",G="/assets/img/de-rain_img/"+E+"/",F=[{x:0,y:0,id:"rn",link:G+"rn0.png",title:"Rainy Image"},{x:d*a+l,y:0,id:"baseline",link:G+"baseline0.png",title:"Baseline De-rained Result"},{x:0,y:a+c,id:"ref",link:G+"ref0.png",title:"Reference Image"},{x:d*a+l,y:a+c,id:"dr",link:G+"dr0.png",title:"Proposed De-rained Result"}];z.selectAll("image").data(F).enter().append("svg:image").attr("class","result_image").attr("width",d*a).attr("height",a).attr("xlink:href",function(t){return t.link}).attr("id",function(t){return t.id}).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).on("mousemove",function(t,e){const r=e.id;if(["rn","baseline","dr"].includes(r)){var[n,i]=d3.pointer(t);n-=e.x,i-=e.y,I.each(function(t){const e=z.selectAll("image").nodes().find(e=>e.id===t.id);let r=R.select("#clipGroup-"+t.id);r.empty()&&(r=R.append("g").attr("id","clipGroup-"+t.id)),r.selectAll("image").remove();r.append("image").attr("clip-path","url(#clip-"+t.id+")").attr("xlink:href",e.getAttributeNS("http://www.w3.org/1999/xlink","href")).attr("x",t.cx-n*$).attr("y",t.cy-i*$).attr("width",d*a*$).attr("z",1).attr("height",a*$)})}}).on("mouseout",function(){I.each(function(t){R.select("#clipGroup-"+t.id).selectAll("image").remove()})}),z.selectAll("text").data(F).enter().append("text").attr("id",function(t){return t.id+"_title"}).style("text-anchor","middle").style("font-weight",700).style("font-size","6px").text(function(t){return t.title}).attr("x",function(t){return a+t.x}).attr("y",function(t){return-3+t.y}).style("font-family","sans-serif");var P=C.selectAll("image").data(b);C.selectAll(".indicator-label").data(b).enter().append("text").attr("class","indicator-label").text(function(t){return"Cityscapes"==t.id?"Cityscapes-Rain":"BDD"==t.id?"BDD100K":void 0}).attr("x",function(t){return t.x+p}).attr("y",function(t){return t.y-2}).attr("text-anchor","middle").attr("text-anchor","middle").style("font-weight",700).style("font-size","5.5px").style("opacity",function(t){return t.opacity}).style("font-family","sans-serif"),P.enter().append("image").attr("class","indicator_image").attr("width",p*d).attr("height",p).attr("xlink:href",function(t){return"/assets/img/de-rain_img/"+t.id+"/dr0.png"}).attr("id",function(t){return t.id}).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("opacity",function(t){return t.opacity}).on("click",n);B.append("rect").attr("width",y).attr("height",h).attr("x",x).attr("y",x).style("fill","white").style("stroke","gray").style("stroke-width",.6);B.append("text").attr("id","button_text").style("text-anchor","middle").text("SHUFFLE \ud83c\udfb2").style("text-anchor","middle").attr("x",x+y/2).attr("y",x+h/2+2.1).style("font-weight",600).style("font-size","5.5px").style("font-family","sans-serif"),B.on("click",function(){const n=z.select("#rn"),i=z.select("#baseline"),a=z.select("#dr"),l=z.select("#ref"),c=n.attr("xlink:href"),o=i.attr("xlink:href"),s=a.attr("xlink:href"),d=l.attr("xlink:href");let p=t(c);if(null!==p){let t=p+1,f=c.replace(`${p}.png`,`${t}.png`),u=o.replace(`${p}.png`,`${t}.png`),g=s.replace(`${p}.png`,`${t}.png`),y=d.replace(`${p}.png`,`${t}.png`);e(g,function(e){if(e)r(n,f,z,500),r(i,u,z,500),r(a,g,z,500),r(l,y,z,500);else{t=0;let e=c.replace(`${p}.png`,`${t}.png`),f=o.replace(`${p}.png`,`${t}.png`),u=s.replace(`${p}.png`,`${t}.png`),g=d.replace(`${p}.png`,`${t}.png`);r(n,e,z,500),r(i,f,z,500),r(a,u,z,500),r(l,g,z,500)}})}}).on("mousedown",function(){d3.select(this).style("opacity",.2)}).on("mouseup",function(){d3.select(this).style("opacity",1)})}n()}();