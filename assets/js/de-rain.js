!function(){function t(t){const e=/rn(\d+)\.png$/,r=t.match(e);return r&&r[1]?parseInt(r[1],10):null}function e(t,e){var r=new Image;r.onload=function(){e(!0)},r.onerror=function(){e(!1)},r.src=t}function r(t,e,r,n){var i=+t.attr("x"),a=+t.attr("y"),l=+t.attr("width"),c=+t.attr("height"),o=r.append("svg:image").attr("id","transition_"+t.id).attr("width",l).attr("height",c).attr("xlink:href",t.attr("xlink:href")).attr("x",i).attr("y",a).style("opacity",1);t.attr("xlink:href",e),t.transition().duration(n),o.transition().duration(n).style("opacity",0).attr("x",i).attr("y",a).remove()}function n(){function n(){const t=d3.select(this).data()[0];var e=R.select("#rn"),n=R.select("#baseline"),i=R.select("#dr"),a=R.select("#ref");E!=t.id&&(z.selectAll(".indicator_image").data(v).attr("opacity",function(e){return t.id==e.id?1:.2}),E=t.id,r(e,(B="/assets/img/de-rain_img/"+E+"/")+"rn0.png",R,500),r(n,B+"baseline0.png",R,500),r(i,B+"dr0.png",R,500),r(a,B+"ref0.png",R,500))}var i={top:10,right:60,bottom:30,left:60},a=70,l=5,c=10,o=2,d=2,s=2,p=25,f=3,g=8,u=60,h=20,y=4,x=27,m=2,$=s*o*a+(o-1)*l,w=d*a+(d-1)*c,k=w+p+f+g,v=[{x:0,y:0,id:"Cityscapes",opacity:1},{x:2*p+f,y:0,id:"BDD",opacity:.2}],_=[{id:"rn",cx:-i.left/2,cy:a/2,r:x},{id:"baseline",cx:s*a*o+l+i.right/2,cy:a/2,r:x},{id:"dr",cx:s*a*o+l+i.right/2,cy:a/2+a+c,r:x}],b=document.createElement("canvas");b.width=2*x,b.height=2*x;b.getContext("2d");var A=d3.select("#result_div").append("svg").attr("width","100%").attr("height","100%").style("min-width",`${($+i.left+i.right)/2}px`).attr("viewBox",`0 0 ${$+i.left+i.right} ${k+i.top+i.bottom}`),R=A.append("g").attr("id","image_group").attr("width",$).attr("height",w).attr("transform",`translate(${i.left}, ${i.top})`),z=A.append("g").attr("id","indicator_group").attr("width",2*s*p+f).attr("height",p+f+c).attr("transform",`translate(${i.left}, ${i.top+w+c+g})`),D=A.append("g").attr("id","button_group").attr("width",u+2*y).attr("height",h+2*y).attr("transform",`translate(${$+i.left-(u+y)}, ${i.top+w+c+g})`),I=A.append("g").attr("id","zoom_group").attr("transform",`translate(${i.left}, ${i.top})`),C=I.selectAll("circle").data(_).enter().append("circle").attr("id",function(t){return t.id+"circle"}).attr("r",function(t){return t.r}).attr("cx",function(t){return t.cx}).attr("cy",function(t){return t.cy}).style("fill","none");_.forEach(function(t){A.append("defs").append("clipPath").attr("id","clip-"+t.id).append("circle").attr("cx",t.cx).attr("cy",t.cy).attr("r",t.r)}),z.append("text").attr("x",z.attr("width")/2).attr("y",-g/2).attr("text-anchor","middle").style("font-weight",700).style("font-size","6px").text("Click to select a different dataset:").style("font-family","sans-serif");var E="Cityscapes",B="/assets/img/de-rain_img/"+E+"/",G=[{x:0,y:0,id:"rn",link:B+"rn0.png",title:"Rainy Image"},{x:s*a+l,y:0,id:"baseline",link:B+"baseline0.png",title:"Baseline De-rained Result"},{x:0,y:a+c,id:"ref",link:B+"ref0.png",title:"Reference Image"},{x:s*a+l,y:a+c,id:"dr",link:B+"dr0.png",title:"Pipeline De-rained Result"}];R.selectAll("image").data(G).enter().append("svg:image").attr("class","result_image").attr("width",s*a).attr("height",a).attr("xlink:href",function(t){return t.link}).attr("id",function(t){return t.id}).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).on("mousemove",function(t,e){const r=e.id;if(["rn","baseline","dr"].includes(r)){var[n,i]=d3.pointer(t);n-=e.x,i-=e.y,C.each(function(t){const e=R.selectAll("image").nodes().find(e=>e.id===t.id);console.log("matchedImageData",e.href);let r=I.select("#clipGroup-"+t.id);r.empty()&&(r=I.append("g").attr("id","clipGroup-"+t.id)),r.selectAll("image").remove();r.append("image").attr("clip-path","url(#clip-"+t.id+")").attr("xlink:href",e.getAttributeNS("http://www.w3.org/1999/xlink","href")).attr("x",t.cx-n*m).attr("y",t.cy-i*m).attr("width",s*a*m).attr("z",1).attr("height",a*m)})}}).on("mouseout",function(){C.each(function(t){I.select("#clipGroup-"+t.id).selectAll("image").remove()})}),R.selectAll("text").data(G).enter().append("text").attr("id",function(t){return t.id+"_title"}).style("text-anchor","middle").style("font-weight",700).style("font-size","6px").text(function(t){return t.title}).attr("x",function(t){return a+t.x}).attr("y",function(t){return-3+t.y}).style("font-family","sans-serif");var P=z.selectAll("image").data(v);P.enter().append("text"),P.enter().append("image").attr("class","indicator_image").attr("width",2*p).attr("height",p).attr("xlink:href",function(t){return"/assets/img/de-rain_img/"+t.id+"/dr0.png"}).attr("id",function(t){return t.id}).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("opacity",function(t){return t.opacity}).on("click",n);D.append("rect").attr("width",u).attr("height",h).attr("x",y).attr("y",y).style("fill","white").style("stroke","gray").style("stroke-width",1);D.append("text").attr("id","button_text").style("text-anchor","middle").text("MORE RESULT").style("text-anchor","middle").attr("x",y+u/2).attr("y",y+h/2+2.5).style("font-weight",600).style("font-size","7px").style("font-family","sans-serif"),D.on("click",function(){const n=R.select("#rn"),i=R.select("#baseline"),a=R.select("#dr"),l=R.select("#ref"),c=n.attr("xlink:href"),o=i.attr("xlink:href"),d=a.attr("xlink:href"),s=l.attr("xlink:href");let p=t(c);if(null!==p){let t=p+1,f=c.replace(`${p}.png`,`${t}.png`),g=o.replace(`${p}.png`,`${t}.png`),u=d.replace(`${p}.png`,`${t}.png`),h=s.replace(`${p}.png`,`${t}.png`);e(u,function(e){if(e)r(n,f,R,500),r(i,g,R,500),r(a,u,R,500),r(l,h,R,500);else{t=0;let e=c.replace(`${p}.png`,`${t}.png`),f=o.replace(`${p}.png`,`${t}.png`),g=d.replace(`${p}.png`,`${t}.png`),u=s.replace(`${p}.png`,`${t}.png`);r(n,e,R,500),r(i,f,R,500),r(a,g,R,500),r(l,u,R,500)}})}}).on("mousedown",function(){d3.select(this).style("opacity",.2)}).on("mouseup",function(){d3.select(this).style("opacity",1)})}n()}();